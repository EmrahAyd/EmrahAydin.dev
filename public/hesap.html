<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <script src="https://kit.fontawesome.com/7e73ae492b.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  </head>
  <body>
    <style> 
    body {
        padding-left: 0px;
padding-right: 15px;

    
    }
        .float{
	position:fixed;
	width:60px;
	height:60px;
	bottom:40px;
	right:40px;
	background-color:#2593d3;
	color:#FFF;
	border-radius:50px;
	text-align:center;
    font-size:30px;
	box-shadow: 2px 2px 3px #999;
    z-index:100;
}
.modal-pop{ 
    width: 95%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 2em;
    background: white;
    position: fixed;
z-index: 999;
border-radius: 25px;
border: rgba(153, 153, 153, 0.589) 1px solid;}
.tons{
    text-align: right;
    border-radius: 25px;
    color: #ff3131b7;
}


.switch::before,
.switch::after {
   content: "";
   width: 10vw;
   height: 10vw;
   background-color: white;
   position: absolute;
   border-radius: 50%;
   top: 50%;
   left:33%;
   transition: all 350ms cubic-bezier(0, 0.95, 0.99, 0.98),
    background 350ms ease;
   transform-origin: right left;
}

.switch::after {
   background: #fbd3e1;
   border: 1vw solid pink;
}
input:checked + .switch:before {
   background: #d3f0fb;
   transform: translateX(165%);
   border: 1vw solid pink;
}
input + .switch .female {
   color: pink;
}
input:checked + .switch .male {
   color: lightblue;
}
input + .switch .male {
   color: #ccc;
}
input:checked + .switch .female {
   color: #ccc;
}
input:checked + .switch:after {
   background: #d3f0fb;
   transform: translateX(165%);
   border: 1vw solid lightblue;
}
.female,
.male {
   position: relative;
   z-index: -1;
   font-weight: lighter;
   color: #ccc;
}
.female {
   z-index: -1;
   transform: rotate(180deg);
   font-size: 10vw;
}
.male {
   z-index: -1;
   font-size: 10vw;
   transform: rotate(-50deg);
}

    </style>

<script>let geen = true </script>




    <div class="container" >
      <div class="row">
        <div class="col-12 fixed-top" style="overflow: hidden ; background:rgb(255, 255, 255);">



            <h1 style="margin-top: 15px ; text-align: center">Harcamanızı Giriniz <span><button type="button" class="btn btn-success float" id="refresh" style="margin-left:2px;" ><i class="fa-solid fa-arrows-rotate"></i></button>
            </span></h1>
<hr>    
            <div class="input-group mb-3 ">
                <input type="text" class="form-control" id="tip" placeholder="Açıklama" aria-label="Amount (to the nearest dollar)">
                <span  style="width:20%;">
                    
                    <input type="number" class="form-control" id="gir" placeholder="Tutar" aria-label="Amount (to the nearest dollar)">

                </span>
                <span class="input-group-text" style="width:4%; text-align: center; padding: 2px; margin: 0px;" >₺</span>

                <span style="width:25%;">
                <select class="form-select form-select-md" id="gerek" aria-label=".form-select-sm example" >
                    <option selected >Genel</option>
                    <option >Mutfak</option>
                    <option >Hobi</option>
                    <option  >Ulaşım</option>
                    <option >Bireysel</option>
                    <option >Giyim</option>
                    <option >Sağlık</option>
                  </select>
                </span>

                <button type="button" class="btn btn-danger" style="margin-left:2px;" id="harcama">Harcama</button>

              </div>

              <div class="row" id="nedir">
                <div class="col-4">
                <h1 style="margin-left:15px;" >Elif</h1>
                </div>

                <div class="col-4"style="height:50px;" >
                    <div>
                        <input id="switch" type="checkbox" hidden>
                            <label for="switch" class="switch" onclick="{if (geen==true){geen= false ; console.log(geen)} else (geen= true )}"></label>
                    </div>
                </div>

                <div class="col-4">
                    <h1 style="margin-bottom:0px;">Emrah</h1>
                    <h8 style="display:inline-flex; margin-top: 1px; color: rgba(94, 123, 253, 0.425);">Credit: <span id="eo" style="color: rgba(119, 119, 119, 0.74); font-weight:bold;"></span></h8>
                </div>
                </div>



              <div class="row">
              <div class="col-6" style="border-right: 1px solid #e67e22;">
                <h1 style="text-align:center; color:gray; font-size: medium;">Günlük Harcama<span> <h3 style="text-align: center; color: rgb(0, 0, 0);" id="gunluk">25</h3></span></h1>
            </div>
            
            <div class="col-6">
                <h1 style="text-align:center;color: gray;font-size: medium; ">Aylık Harcama <span> <h3 style="text-align: center; color: rgb(0, 0, 0);" id="aylik">25</h3></span></h1>
            </div>
          </div>
          <hr />
        </div>
        </div>
      </div>
      
      <hr />
      

      <div class="row" style="margin-top: 68%;">
       
        <div class="col-12 mt-3" >
            <div id="liveAlertPlaceholder"></div>

            <ul class="list-group list-group-numbered" id="liste">

            </ul>
        </div>
      </div>
      
          
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</div>



    <script type="module">


        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
              const firebaseConfig = {
                                        apiKey: "AIzaSyDgzuRwTOJ1TSTYnNR02GCVt_-f0tIof6k",
                                        authDomain: "hesap-85989.firebaseapp.com",
                                        projectId: "hesap-85989",
                                        storageBucket: "hesap-85989.appspot.com",
                                        messagingSenderId: "789853114973",
                                        appId: "1:789853114973:web:71d1ec2e95fa00d139f3b4",
                                    };

                                    // Initialize Firebase
                                    const app = initializeApp(firebaseConfig);

                                    import {
                                        getFirestore , doc , getDoc , setDoc , collection , addDoc, updateDoc , deleteDoc, deleteField, query, where, getDocs, orderBy
                                    }
                                    from "https://www.gstatic.com/firebasejs/9.6.8/firebase-firestore.js";

                                    const db = getFirestore();
            ////////////////////////////////////
            let yenile = document.getElementById("refresh");
            yenile.addEventListener("click",function(){
            window.location.reload();
            });
            ////////////////////////////////////
                            const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
                            let liste = document.querySelector("#liste");
                            let gunluk = document.querySelector("#gunluk");
                            let aylik = document.querySelector("#aylik");
                            let totalg = 0;
                            let total = 0;
                            let mutfak = 0;
                            let hobi = 0;
                            let ulasim = 0;
                            let bireysel = 0;
                            let genel = 0;
                            let harli=[];
                            let bakiye = 1950;
                            



                            var tarih = new Date();
                            let idx = tarih.toString().split(" ").join("");
                            idx= idx.split(":").join("");
                            idx= idx.split("(").join("");
                            idx= idx.split(")").join("");
                            idx= idx.split("+").join("");


                            let ay = tarih.getMonth()+100
                            ay = ay.toString().slice(-2)
                            let gun = tarih.getDate()+100
                            gun = gun.toString().slice(-2)
                            let saat = tarih.getHours()+100
                            saat = saat.toString().slice(-2)
                            let dakika = tarih.getMinutes()+100
                            dakika = dakika.toString().slice(-2)
                            let saniye = tarih.getSeconds()+100
                            saniye = saniye.toString().slice(-2)
                            let uniqueId = tarih.getFullYear().toString()+ay+gun+saat+dakika+saniye;
                            uniqueId = parseInt(uniqueId);
                            console.log(uniqueId);






                            function clearalert() {
                                                    alertPlaceholder.innerHTML = "";
                                                    }


                            const alerti = (message, type) => {
                                                                const wrapper = document.createElement('div')
                                                                wrapper.innerHTML = [
                                                                                        `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                                                                                        `   <div>${message}</div>`,
                                                                                        '   <button type="button" class="btn-close" data-bs-dismiss="alert" onClick="location.reload()" aria-label="Close"></button>',
                                                                                        '</div>'
                                                                                    ].join('')

                                                                alertPlaceholder.append(wrapper)
                                                                }

                document.getElementById("harcama").addEventListener("click",harcar)

                let harcamaGun = tarih.getTime()
                harcamaGun = harcamaGun.toString()


                function bak(){
                        var ref = doc(db, "sayac", "LCr3FKACNRk0r94pmFtp");

                }



                async function harcar() {
                    liste.innerHTML = "";

                    
                    var ref = doc(db, "harcama", uniqueId.toString());
                    if(document.getElementById("tip").value == ""){
                        alerti("Açıklama girmeniz gerekir.","danger");
                        const myTimeout = setTimeout(clearalert, 5000);
                        return;
                    }
                    else if(document.getElementById("gir").value == ""){
                        alerti("Tutar girmeniz gerekir.","danger");
                        const myTimeout = setTimeout(clearalert, 5000);
                        return;
                    }

                    else{
                       
                    
                    const docRef = await setDoc(
                        ref, {
                            id: uniqueId,
                            gender: geen,
                            Tutar: document.getElementById("gir").value,
                            Tarih: tarih.toLocaleDateString(),
                            Tip: document.getElementById("tip").value,
                            Gerek: document.getElementById('gerek').value
                        }
                    )
                    .then(() =>{
                        alerti("Başarıyla kaydedildi","success");        

                    }).catch((error)=>{
                        alert("Hata"+ error)
                    })
                }



            }

            async function GetDocument(){
                var ref = doc(db, "harcama");
                
                const docSnap = await getDoc(ref);

                if(docSnap.exists()){
                    Namebox.value = docSnap.data().NameOfStd;
                    Rollbox.value = docSnap.data().RollNo
                    Secbox.value = docSnap.data().Section
                    Genbox.value = docSnap.data().Gender
                }
                
                else{
                    alert("Böyle bir şey yok")
                }
            }
            ///////////////////////////////////////////
            async function UpdateFieldsInDoc(){
                var ref = doc(db, "TheStudentList", Rollbox.value);

                     await updateDoc(
                        ref, {
                        NameOfStd: Namebox.value,
                        Section: Secbox.value,
                        Gender: Genbox.value
                    }
                )
                .then(() =>{
                    alert("Güncellendi")
                })
                .catch((error)=>{
                    alert("Hata"+ error)
                })
            }




            async function DeleteDoc(id){
                var ref = doc(db, "harcama", id);

                const docSnap = await getDoc(ref);

                if(!docSnap.exists()){
                    alerti("Bir Hata Oluştu","danger");
                        const myTimeout = setTimeout(clearalert, 5000)
                }
                else{
                await deleteDoc(ref).then(()=>{
                    alerti("Silindi","success");
                    const myTimeout = setTimeout(clearalert, 5000);
                })
                }
            }


            
            function trigger(qq) {
               qq.forEach((doc) => {
                harli.push({
                    gender: doc.data().gender,
                    id: doc.data().id,
                    Tutar: doc.data().Tutar,
                    Tarih: doc.data().Tarih,
                    Tip: doc.data().Tip,
                    Gerek: doc.data().Gerek
                    
                })               
                fiyatekle(doc)
            });             
                } 

                    
            const querySnapshot = await getDocs(collection(db,"harcama"));
            trigger(querySnapshot)





            function fiyatekle(doc) {
                total += parseInt(doc.data().Tutar)


                if(doc.data().Tarih == tarih.toLocaleDateString()){
                    totalg += parseInt(doc.data().Tutar)
                }

                aylik.innerHTML = total + "<span>₺</span>";
                gunluk.innerHTML = totalg + "<span>₺</span>";
                }






            function dokum() {
                console.log(harli)
                harli = harli.sort((a,b) => a.id - b.id);
                console.log(harli)
                harli.forEach((eleman) => {
                let creator=document.createElement("li");
                if(eleman.Tarih == tarih.toLocaleDateString()){creator.setAttribute("style","background-color: rgba(121, 230, 175, 0.158);")}
                else{ }  
                let silbuton=document.createElement("button");


                if(eleman.gender === true){
                    creator.setAttribute("style","background-color: rgba(21, 30, 175, 0.158);")
                }


                else(silbuton.setAttribute("class","btn btn-alert")
)
                if(eleman.id>20220704003431 && eleman.gender === false){
                    bakiye-=parseInt(eleman.Tutar)
                    console.log(bakiye)
                    document.querySelector("#eo").innerHTML = bakiye;
                }
                else{}
                creator.setAttribute("class","list-group-item d-flex justify-content-between align-items-start position-relative");
                creator.innerHTML= `
                <div class="modal-pop" id='`+'p'+'p'+eleman.id +`' style="display:none; "> <p class="fw-bold text-dark" style="">Silmek istediğinize emin misiniz? </p> <br> <br>
                <div class="tons">
                <Button style="background-color:#77bfe9b7;border: 0ch; margin-right:8px; padding:15px; border-radius: 10px; font-weight:bold;" class="uniqeclass" id=`+eleman.id+`>Evet</Button> <button onclick="document.querySelector('.modal-pop').setAttribute('style','display:none;');" style=" font-weight:bold;background-color:#ff3131b7;border: 0ch; border-radius: 10px; padding:15px;" >Hayır</button>
                </div>
                </div>

                <div class='ms-2 me-auto text-secondary' ><p style="display:none">`+eleman.id+`</p> <div class='fw-bold text-dark' style='font-weight:bold;'>` + eleman.Tip + `</div>
                    ` + eleman.Tarih + `</div> <button class='hiyarto btn btn-danger btn-sm position-absolute top-50 start-50 translate-middle ms-5' id='`+'p'+eleman.id +`'>Sil</button><span class='badge bg-success position-absolute top-50 end-0 translate-start me-3 rounded-pill'>` + eleman.Tutar + ` ₺</span>`;
                    if(typeof (eleman.id) === "string"){
                        liste.appendChild(creator);
                    }
                    else{liste.prepend(creator);}
            }
            )
        }





        dokum();
            let uniqeclass = document.getElementsByClassName("uniqeclass")
            for(let i = 0; i < uniqeclass.length; i++){
                uniqeclass[i].addEventListener("click",function(){
                    let id = this.id;
                    DeleteDoc(id).then(()=>{
                        window.location.reload();
                });
                })}
            let hiyartolar = document.getElementsByClassName("hiyarto")
            for(let i = 0; i < hiyartolar.length; i++){
                hiyartolar[i].addEventListener("click",function(){
                    let id = this.id;
                    document.getElementById("p"+id).setAttribute('style','display:block;');
                })}
            
            
            
            // ;



      </script>


  </body>
</html>


  
